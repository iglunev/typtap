'use strict';function f(a,b,d){b="number"===typeof d?Array(d+1).join(" ")+b:b;a.a.push(b)}function h(a){return(a?a:"").split("\n").map(a=>Array(7).join(" ")+a).join("\n")}
class k{constructor(){this.a=[]}start(){f(this,"TAP version 13")}label(a){f(this,"# "+a)}test(a){f(this,`${a.b?"ok":"not ok"} ${a.id} ${a.description}`)}error(a){f(this,"---",2);a instanceof Error?(f(this,`name: ${a.name}`,4),f(this,`message: ${a.message}`,4),f(this,`stack: |-\n${h(a.stack)}`,4)):f(this,`error: ${JSON.stringify(a)}`,4);f(this,"...",2)}flush(){console.log(this.a.join("\n"));this.a=[]}}
var l=Array.isArray,m=Object.keys,n=Object.prototype.hasOwnProperty,q=function p(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var c=l(a),e=l(b);if(c&&e){var g=a.length;if(g!=b.length)return!1;for(c=g;0!==c--;)if(!p(a[c],b[c]))return!1;return!0}if(c!=e)return!1;c=a instanceof Date;e=b instanceof Date;if(c!=e)return!1;if(c&&e)return a.getTime()==b.getTime();c=a instanceof RegExp;e=b instanceof RegExp;if(c!=e)return!1;if(c&&e)return a.toString()==b.toString();e=m(a);g=e.length;
if(g!==m(b).length)return!1;for(c=g;0!==c--;)if(!n.call(b,e[c]))return!1;for(c=g;0!==c--;)if(g=e[c],!p(a[g],b[g]))return!1;return!0}return a!==a&&b!==b};function r(a,b,d){b&&++a.b;a.a&&a.a.test({description:d?d:"",id:++a.f,b})}
class t{constructor(a){this.f=this.b=0;this.g=[];this.a=a;this.c={h:(a,d,c)=>r(this,q(a,d),c),i:a=>r(this,!1,a),j:(a,d,c)=>r(this,!q(a,d),c),l:a=>r(this,!0,a),test:(a,d,c)=>this.test(a,d,c)}}test(a,b,d){this.g.push({description:a,m:async()=>{this.a&&this.a.label(a);try{d&&"number"===typeof d.timeout?await Promise.race([b(this.c),new Promise((a,b)=>{setTimeout(()=>b(Error("Timeout")),d.timeout)})]):await b(this.c)}catch(c){this.a&&this.a.error(c)}}})}}new t(new k);
